-- Database: zeladinho_sneakers

-- DROP DATABASE IF EXISTS zeladinho_sneakers;

CREATE DATABASE zeladinho_sneakers
    WITH
    OWNER = postgres
    ENCODING = 'UTF8'
    LC_COLLATE = 'Spanish_Spain.1252'
    LC_CTYPE = 'Spanish_Spain.1252'
    TABLESPACE = pg_default
    CONNECTION LIMIT = -1
    IS_TEMPLATE = False;

	Create table usuarios(
	idusuario serial primary key,
	nombre_usuario varchar(50) not null,
	apellido_usuario varchar(50) not null,
	correo_usuario varchar(100) not null,
	alias_usuario varchar(50) not null,
	clave_usuario varchar(100) not null
	);
	
	Create table genero_clientes(
	idgenero_cliente serial primary key,
	genero_cliente varchar(20) not null
	);
	
	Create table estado_clientes(
	idestado_cliente serial primary key,
	estado_cliente varchar(20) not null
	);
	
	Create table clientes (
	idcliente serial primary key,
	nombre_cliente varchar(30) not null ,
	apellido_cliente varchar(30) not null,
	dui varchar(10) not null,
	correo varchar(100) not null,
	telefono varchar(9) not null,
	fecha_nacimiento date not null,
	direccion varchar(200) not null,
	clave_cliente varchar(50) not null
	);
	
	Create table generos_productos(
	idgenero_producto serial primary key,
	nombre_genero varchar(15) not null
	);
	
	Create table tipo_productos(
	idtipo_producto serial primary key,
	tipo_producto varchar(20) not null
	);
	
	Create table marcas(
	idmarca serial primary key,
	nombre_marca varchar(100) not null,
	logo varchar(500) not null
	);
	
	create table pedidos(
	id_pedido serial primary key,
	idcliente int not null,
	estado_pedido int not null,
	fecha_pedido date not null,
	direccion_pedido varchar(500)
	);
	
	Create table productos(
	idproducto serial primary key,
	nombre_producto varchar(150) not null,
	descripcion varchar(500) not null,
	precio numeric(5,2) not null,
	idmarca int not null,
	idgenero_producto int not null,
	idtipo_producto int not null,
	imagen varchar(800) null,
	idusuario int not null,
	descuento numeric(5,2) null,
	estado_producto boolean not null
	);
	
	Create table tallas(
	idtalla serial primary key,
	num_talla numeric(3,1)
	);

	Create table detalle_productos(
	iddetalle_producto serial primary key,
	idproducto int not null,
	idtalla int not null,
	existencia int not null	
	);

	Create table detalle_pedidos(
	iddetalle_pedido serial primary key,
	id_pedido int not null,
	idproducto int not null,
	cantidad_producto int not null,
	precio numeric(5,2) not null
	);
	
	create table valoraciones(
	idvaloracion serial primary key,
	iddetalle_pedido int not null,
	calificacion_producto int not null,
	idcliente int not null,
	titulo varchar(50) not null,
	resenia varchar(800) not null,
	fecha_comentario date not null,
	estado_valoracion boolean not null
	);

ALTER TABLE clientes
ADD UNIQUE (dui);

ALTER TABLE clientes
ADD UNIQUE (correo);

ALTER TABLE clientes
ADD UNIQUE (telefono);

ALTER TABLE usuarios
ADD UNIQUE (correo_usuario);

ALTER TABLE usuarios
ADD UNIQUE (alias_usuario);
	
ALTER TABLE productos
ADD CONSTRAINT usuario_producto
FOREIGN KEY (idusuario) 
REFERENCES usuarios(idusuario);
	
ALTER TABLE pedidos
ADD CONSTRAINT pedido_cliente
FOREIGN KEY (idcliente) 
REFERENCES clientes(idcliente);

ALTER TABLE productos
ADD CONSTRAINT genero_producto
FOREIGN KEY (idgenero_producto) 
REFERENCES generos_productos(idgenero_producto)
ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE productos
ADD CONSTRAINT marca_producto
FOREIGN KEY (idmarca) 
REFERENCES marcas(idmarca)
ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE productos
ADD CONSTRAINT tipo_productos
FOREIGN KEY (idtipo_producto) 
REFERENCES tipo_productos(idtipo_producto)
ON UPDATE CASCADE
ON DELETE CASCADE;

ALTER TABLE detalle_pedidos
ADD CONSTRAINT detalle_producto
FOREIGN KEY (idproducto) 
REFERENCES productos(idproducto);

select * from clientes

ALTER TABLE detalle_productos
ADD CONSTRAINT detalle_talla
FOREIGN KEY (idtalla) 
REFERENCES tallas(idtalla);

ALTER TABLE detalle_productos
ADD CONSTRAINT detalle_prod
FOREIGN KEY (idproducto) 
REFERENCES productos(idproducto);

ALTER TABLE detalle_pedidos
ADD CONSTRAINT detalle_pedido
FOREIGN KEY (id_pedido) 
REFERENCES pedidos(id_pedido);

ALTER TABLE valoraciones
ADD CONSTRAINT detalle_valoracion
FOREIGN KEY (iddetalle_pedido) 
REFERENCES detalle_pedidos(iddetalle_pedido);

ALTER TABLE valoraciones
ADD CONSTRAINT cliente_valoracion
FOREIGN KEY (idcliente) 
REFERENCES clientes(idcliente);


Insert Into genero_clientes(genero_cliente)
values ('Masculino'),
('Femenino')

Insert Into estado_clientes(estado_cliente)
values ('Activo'),
('Inactivo'),
('Bloquedo')

Insert Into estado_pedidos(estado_pedido)
values ('Entregado'),
('En Camino'),
('Cancelado'),
('Bloqueado')

Insert Into clientes(nombre_cliente, apellido_cliente, dui, correo, telefono, fecha_nacimiento, direccion, idgenero_cliente, idestado_cliente, clave_cliente)
values ('Luis', 'Cruz', '12345679-0','hola123@gmail.com','7894-6515', '2004-04-26','San Salvador', 1, 1, 'hola123')
	 
Insert Into pedidos(idcliente, idestado_pedido, fecha_pedido, direccion_pedido)
values (1, 3,'2023-04-26', 'San Salvador')	

Insert Into detalle_pedidos(idpedido, iddetalle_producto, cantidad_producto)
values (1, 1, '2')
	
Insert Into valoraciones(iddetalle_pedido, calificacion_producto, nombre, titulo, resenia, fecha_comentario, estado_valoracion)
values (1, 5, 'Luis','Rese√±a de zapatos','Articulo recomendado','2023-04-26', 'YES')
